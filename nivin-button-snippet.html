<!-- Nivín Floating Chat Button -->
<div id="nivin-float-button" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; cursor: pointer;">
    <div style="width: 70px; height: 70px; background: linear-gradient(135deg, #388E3C, #2E7D32); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 20px rgba(56, 142, 60, 0.4); transition: transform 0.3s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" onclick="window.toggleNivinChat ? window.toggleNivinChat() : openNivinChat()">
        <span style="font-size: 35px;">🤖</span>
    </div>
</div>

<!-- Nivín Chat Modal -->
<div id="nivin-chat-modal" style="display: none; position: fixed; bottom: 100px; right: 20px; width: 400px; max-width: 90vw; height: 600px; max-height: 80vh; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 10000; flex-direction: column; overflow: hidden;">
    <!-- Header -->
    <div style="background: linear-gradient(135deg, #388E3C, #2E7D32); padding: 20px; color: white; display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h3 style="margin: 0; color: white; font-size: 18px;">🤖 Nivín - Asistente Médico</h3>
            <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9;">Centro Médico Universal</p>
        </div>
        <button onclick="closeNivinChat()" style="background: rgba(255,255,255,0.2); border: none; color: white; font-size: 28px; cursor: pointer; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; padding: 0;">×</button>
    </div>
    
    <!-- Messages -->
    <div id="nivin-messages" style="flex: 1; overflow-y: auto; padding: 20px; background: #f5f5f5;">
        <div style="background: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            ¡Hola! Soy Nivín, tu asistente médico virtual de Centro Médico Universal. 👋<br><br>
            ¿En qué puedo ayudarte hoy?
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div style="padding: 10px; background: white; border-top: 1px solid #e0e0e0; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
        <button onclick="nivinAction('cita')" style="padding: 8px 12px; background: #e8f5e9; border: 1px solid #388E3C; border-radius: 20px; color: #2E7D32; font-size: 12px; cursor: pointer; font-weight: 600;">📅 Solicitar Cita</button>
        <button onclick="nivinAction('queja')" style="padding: 8px 12px; background: #ffebee; border: 1px solid #f44336; border-radius: 20px; color: #c62828; font-size: 12px; cursor: pointer; font-weight: 600;">📝 Poner Queja</button>
        <button onclick="nivinAction('info')" style="padding: 8px 12px; background: #e3f2fd; border: 1px solid #2196f3; border-radius: 20px; color: #1976d2; font-size: 12px; cursor: pointer; font-weight: 600;">ℹ️ Información</button>
    </div>
    
    <!-- Input -->
    <div style="padding: 15px; background: white; border-top: 1px solid #e0e0e0;">
        <div style="display: flex; gap: 10px;">
            <input type="text" id="nivin-input" placeholder="Escribe tu mensaje..." style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 25px; outline: none; font-size: 14px;" onkeypress="if(event.key==='Enter') sendNivinMessage()">
            <button onclick="sendNivinMessage()" style="background: linear-gradient(135deg, #388E3C, #2E7D32); color: white; border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">➤</button>
        </div>
    </div>
</div>

<script>
function openNivinChat() {
    document.getElementById('nivin-chat-modal').style.display = 'flex';
    window.toggleNivinChat = closeNivinChat;
}

function closeNivinChat() {
    document.getElementById('nivin-chat-modal').style.display = 'none';
    window.toggleNivinChat = openNivinChat;
}

window.toggleNivinChat = openNivinChat;

function nivinAction(type) {
    const input = document.getElementById('nivin-input');
    if (type === 'cita') input.value = 'Necesito una cita';
    else if (type === 'queja') input.value = 'Quiero poner una queja';
    else if (type === 'info') input.value = 'Información sobre servicios';
    sendNivinMessage();
}

function sendNivinMessage() {
    const input = document.getElementById('nivin-input');
    const msg = input.value.trim();
    if (!msg) return;
    
    const messagesDiv = document.getElementById('nivin-messages');
    
    // User message
    const userDiv = document.createElement('div');
    userDiv.style.cssText = 'background: linear-gradient(135deg, #388E3C, #2E7D32); color: white; padding: 12px 16px; border-radius: 18px; margin: 10px 0; margin-left: auto; max-width: 75%; text-align: right;';
    userDiv.textContent = msg;
    messagesDiv.appendChild(userDiv);
    
    input.value = '';
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    
    // Bot response via Gemini if available
    if (window.NivinAI && window.NivinAI.handleMessage) {
        window.NivinAI.handleMessage(msg, messagesDiv);
    } else {
        // Fallback response
        setTimeout(() => {
            const botDiv = document.createElement('div');
            botDiv.style.cssText = 'background: white; padding: 15px; border-radius: 15px; margin: 10px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);';
            botDiv.innerHTML = 'Procesando su solicitud...<br><br>Para asistencia inmediata, llame al <a href="tel:+18095946161" style="color: #388E3C; font-weight: bold;">(809) 594-6161</a>';
            messagesDiv.appendChild(botDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }, 500);
    }
}
</script>
